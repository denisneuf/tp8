{extend name="admin/layout" /}

{block name="content"}
<div class="card">
    <div class="card-header">
        <h3>Listado de productos</h3>
        <a href="{:url('product_create')}" class="btn btn-primary float-right">Nuevo producto</a>
    </div>

    pollas{$products|raw}
    <div class="card-body">
        {if isset($products) && $products|count > 0}
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Marca</th>
                    <th>Categoría</th>
                    <th>Tipo</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Visible</th>
                    <th>Disponible</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {volist name="products" id="product"}
                <tr>
                    <td>{$product.id}</td>
                    <td>{$product.name}</td>
                    <td>{$product.brand.name|default='-'}</td>
                    <td>{$product.category.name|default='-'}</td>
                    <td>{$product.product_type.name|default='-'}</td>
                    <td>{$product.price}</td>
                    <td>{$product.stock}</td>
                    <td>{if $product.visible}✔️{else}❌{/if}</td>
                    <td>{if $product.available}✔️{else}❌{/if}</td>
                    <td>
                        <a href="{:url('product_edit', ['id' => $product.id])}" class="btn btn-sm btn-warning">Editar</a>
                        {if $product.delete_time}
                            <form method="post" action="{:url('product_restore', ['id' => $product.id])}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-success">Restaurar</button>
                            </form>
                        {else}
                            <button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteModal{$product.id}">Eliminar</button>
                        {/if}
                    </td>
                </tr>

                <!-- Modal de confirmación -->
                <div class="modal fade" id="deleteModal{$product.id}" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                        <form method="post" action="{:url('product_delete', ['id' => $product.id])}">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Confirmar eliminación</h5>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    ¿Estás seguro de que deseas eliminar el producto <strong>{$product.name}</strong>?
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-danger">Eliminar</button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                {/volist}
            </tbody>
        </table>

        {$products|raw}
        {else}
        <p>No hay productos registrados.</p>
        {/if}
    </div>