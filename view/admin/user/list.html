{extend name="admin/layout" /}

{block name="content"}

<h1>Usuarios</h1>

{if isset($success)}
<div class="alert alert-success alert-dismissible fade show" role="alert">
  <strong>Éxito:</strong> {$success}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
</div>
{/if}

{if isset($error)}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <strong>Error:</strong> {$error}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
</div>
{/if}

<a href="{:url('user_create')}" class="btn btn-success mb-3">Crear Usuario</a>

<table class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Mobile</th>
            <th>Bloqueado</th>
            <th>Última IP</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {volist name="users" id="user"}
        <tr>
            <td>{$user.id}</td>
            <td>{$user.username}</td>
            <td>{$user.email}</td>
            <td>{$user.mobile}</td>
            <td>{if $user.islock}Sí{else}No{/if}</td>
            <td>{$user.lastip}</td>
            <td>
                <a href="{:url('user_edit', ['id' => $user.id])}" class="btn btn-sm btn-primary">Editar</a>

                {if $user.delete_time}
                    <form action="{:url('user_restore', ['id' => $user.id])}" method="post" style="display:inline;">
                        <input type="hidden" name="__token__" value="{:token()}" />
                        <button type="submit" class="btn btn-sm btn-warning">Restaurar</button>
                    </form>
                {else}
                    <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{$user.id}">Eliminar</button>

                    <!-- Modal -->
                    <div class="modal fade" id="deleteModal{$user.id}" tabindex="-1" aria-labelledby="deleteModalLabel{$user.id}" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title">Confirmar eliminación</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                          </div>
                          <div class="modal-body">
                            ¿Seguro que quieres eliminar al usuario "<strong>{$user.username}</strong>"?
                          </div>
                          <div class="modal-footer">
                            <form action="{:url('user_delete', ['id' => $user.id])}" method="post">
                                <input type="hidden" name="__token__" value="{:token()}" />
                                <button type="submit" class="btn btn-danger">Eliminar</button>
                            </form>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                          </div>
                        </div>
                      </div>
                    </div>
                {/if}
            </td>
        </tr>
        {/volist}
    </tbody>
</table>

{$users|raw}

{/block}
